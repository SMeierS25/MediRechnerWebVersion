workflows:
  ionic_ios_build:
    name: Build Ionic Angular App for iOS (No Credentials)
    environment:
      node: 20.0
      java: 17
      xcode: 15.0
    scripts:
      - name: Install npm dependencies
        script: npm ci

      - name: Add iOS platform (falls nicht im Repo)
        script: npx cap add ios

      - name: Build Ionic Web (f√ºr iOS Assets)
        script: npx ionic build

      - name: Sync iOS code
        script: npx cap sync ios

      - name: Install iOS CocoaPods
        script: |
          cd ios
          pod install

      - name: Build iOS (unsigned)
        script: |
          cd ios
          xcodebuild -scheme App -workspace App.xcworkspace -configuration Release -derivedDataPath build -sdk iphoneos CODE_SIGNING_ALLOWED=NO

    artifacts:
      - ios/build/Build/Products/Release-iphoneos/*.app

    cache:
      cache_paths:
        - ~/.npm
        - node_modules
